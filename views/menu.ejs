<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= menu.brandName %> - Menu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="menu-page" data-brand="<%= brand %>">

  <nav class="navbar navbar-light bg-light">
    <div class="container-fluid">
      <a href="/" class="btn btn-sm btn-outline-secondary">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
        </svg>
        Back
      </a>
      <h5 class="mb-0 brand-title"><%= menu.brandName %></h5>
      <div style="width: 60px;"></div>
    </div>
  </nav>

  <div class="category-nav">
    <div class="container-fluid">
      <div class="category-scroll">
        <% menu.categories.forEach((category, index) => { %>
          <a href="#category-<%= index %>" class="category-link">
            <%= category.name %>
          </a>
        <% }); %>
      </div>
    </div>
  </div>

  <div class="container-fluid py-4">
    <% menu.categories.forEach((category, categoryIndex) => { %>
      <div class="category-section" id="category-<%= categoryIndex %>">
        <div class="category-header mb-3">
          <h3 class="category-title"><%= category.name %></h3>
          <% if (category.description) { %>
            <p class="category-description text-muted"><%= category.description %></p>
          <% } %>
        </div>

        <div class="row g-3">
          <% category.items.forEach((item, itemIndex) => { %>
            <div class="col-12 col-md-6 col-lg-4">
              <div class="menu-item-card <%= item.variations ? 'has-variations' : '' %>"
                   <% if (item.variations) { %>
                   data-bs-toggle="modal"
                   data-bs-target="#variationModal-<%= categoryIndex %>-<%= itemIndex %>"
                   style="cursor: pointer;"
                   <% } %>>
                <% if (item.image) { %>
                  <div class="menu-item-image" style="background-image: url('<%= item.image %>')"></div>
                <% } %>
                <div class="menu-item-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="menu-item-title mb-0"><%= item.title %></h5>
                    <% if (item.variations) { %>
                      <span class="menu-item-price">from ₹<%= Math.min(...item.variations.map(v => v.price)) %></span>
                    <% } else { %>
                      <span class="menu-item-price">₹<%= item.price %></span>
                    <% } %>
                  </div>
                  <p class="menu-item-description text-muted"><%= item.description %></p>
                  <% if (item.variations) { %>
                    <div class="variation-badge">
                      <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                      </svg>
                      <%= item.variations.length %> options
                    </div>
                  <% } %>
                </div>
              </div>
            </div>

            <!-- Variation Modal -->
            <% if (item.variations) { %>
              <div class="modal fade" id="variationModal-<%= categoryIndex %>-<%= itemIndex %>" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title"><%= item.title %></h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <p class="text-muted small mb-3"><%= item.description %></p>
                      <h6 class="mb-3">Select an option:</h6>
                      <div class="variation-list">
                        <% item.variations.forEach(variation => { %>
                          <div class="variation-option">
                            <div class="variation-info">
                              <span class="variation-name"><%= variation.name %></span>
                            </div>
                            <span class="variation-price">₹<%= variation.price %></span>
                          </div>
                        <% }); %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% } %>
          <% }); %>
        </div>
      </div>
    <% }); %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.querySelectorAll('.category-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href');
        const targetElement = document.querySelector(targetId);

        if (targetElement) {
          const navbarHeight = document.querySelector('.navbar').offsetHeight;
          const categoryNavHeight = document.querySelector('.category-nav').offsetHeight;
          const offset = navbarHeight + categoryNavHeight + 16;

          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - offset;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });

          document.querySelectorAll('.category-link').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const sections = document.querySelectorAll('.category-section');
          const navbarHeight = document.querySelector('.navbar').offsetHeight;
          const categoryNavHeight = document.querySelector('.category-nav').offsetHeight;
          const offset = navbarHeight + categoryNavHeight + 50;

          sections.forEach((section, index) => {
            const rect = section.getBoundingClientRect();
            if (rect.top <= offset && rect.bottom > offset) {
              document.querySelectorAll('.category-link').forEach(l => l.classList.remove('active'));
              document.querySelector(`a[href="#category-${index}"]`)?.classList.add('active');
            }
          });

          ticking = false;
        });
        ticking = true;
      }
    });

    document.querySelector('.category-link')?.classList.add('active');
  </script>
</body>
</html>
