<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= menu.brandName %> - Menu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="menu-page" data-brand="<%= brand %>">

  <nav class="navbar navbar-light bg-light">
    <div class="container-fluid">
      <a href="/" class="btn btn-sm btn-outline-secondary">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
        </svg>
        Back
      </a>
      <h5 class="mb-0 brand-title"><%= menu.brandName %></h5>
      <div style="width: 60px;"></div>
    </div>
  </nav>

  <div class="category-nav">
    <div class="container-fluid">
      <div class="category-scroll">
        <% menu.categories.forEach((category, index) => { %>
          <a href="#category-<%= index %>" class="category-link">
            <%= category.name %>
          </a>
        <% }); %>
      </div>
    </div>
  </div>

  <div class="container-fluid py-4">
    <% menu.categories.forEach((category, categoryIndex) => { %>
      <div class="category-section" id="category-<%= categoryIndex %>">
        <div class="category-header mb-3">
          <h3 class="category-title"><%= category.name %></h3>
          <% if (category.description) { %>
            <p class="category-description text-muted"><%= category.description %></p>
          <% } %>
        </div>

        <div class="row g-3">
          <% category.items.forEach((item, itemIndex) => { %>
            <div class="col-12 col-md-6 col-lg-4">
              <div class="menu-item-card">
                <% if (item.image) { %>
                  <div class="menu-item-image" style="background-image: url('<%= item.image %>')"></div>
                <% } %>
                <div class="menu-item-body">
                  <h5 class="menu-item-title mb-2"><%= item.title %></h5>
                  <p class="menu-item-description text-muted mb-3"><%= item.description %></p>

                  <% if (item.variations) { %>
                    <div class="variations-inline">
                      <% item.variations.forEach((variation, vIndex) => { %>
                        <div class="variation-row">
                          <span class="variation-name"><%= variation.name %></span>
                          <span class="variation-price">₹<%= variation.price %></span>
                        </div>
                      <% }); %>
                    </div>
                  <% } else { %>
                    <div class="menu-item-price-single">₹<%= item.price %></div>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    <% }); %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.querySelectorAll('.category-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href');
        const targetElement = document.querySelector(targetId);

        if (targetElement) {
          const navbarHeight = document.querySelector('.navbar').offsetHeight;
          const categoryNavHeight = document.querySelector('.category-nav').offsetHeight;
          const offset = navbarHeight + categoryNavHeight + 16;

          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - offset;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });

          document.querySelectorAll('.category-link').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    });

    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const sections = document.querySelectorAll('.category-section');
          const navbarHeight = document.querySelector('.navbar').offsetHeight;
          const categoryNavHeight = document.querySelector('.category-nav').offsetHeight;
          const offset = navbarHeight + categoryNavHeight + 50;

          sections.forEach((section, index) => {
            const rect = section.getBoundingClientRect();
            if (rect.top <= offset && rect.bottom > offset) {
              document.querySelectorAll('.category-link').forEach(l => l.classList.remove('active'));
              document.querySelector(`a[href="#category-${index}"]`)?.classList.add('active');
            }
          });

          ticking = false;
        });
        ticking = true;
      }
    });

    document.querySelector('.category-link')?.classList.add('active');
  </script>
</body>
</html>
